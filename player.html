<!DOCTYPE html>
<html>
<head>
    <title>Player</title>
    <link href="https://unpkg.com/video.js/dist/video-js.min.css" rel="stylesheet" />
    <script src="https://unpkg.com/video.js/dist/video.min.js"></script>
    <style>
        body {
            background-color: black;
            margin: 0;
            overflow: hidden;
        }
        .video-js {
            width: 100vw !important;
            height: 100vh !important;
        }
        #message {
            visibility: hidden;
            color: white;
            text-align: center;
            font-size: 1.5em;
            position: fixed;
            left: 50%;
            top: 75%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.6);
            padding: 10px 20px;
            border-radius: 8px;
            z-index: 1000;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="video-container">
        <video id="my-video" class="video-js"></video>
    </div>
    <div id="message"></div>
    <script>
        let url = null;
        let player = null;
        let overlayMessageTimeout;
        const playbackRates = [1, 1.25, 1.5, 1.75, 2, 0.25, 0.5, 0.75];
        let playbackRateIndex = 1;
        player = videojs("my-video", {
            controls: true,
            autoplay: false,
            preload: "auto",
            fluid: false
        });
        window.onload = loadPlayer;
        if (screen.orientation) {
            screen.orientation.addEventListener("change", function() {
                if (screen.orientation.type.startsWith("landscape")) {
                    if (!player.isFullscreen()) {
                        player.requestFullscreen();
                    }
                } else if (screen.orientation.type.startsWith("portrait")) {
                    if (player.isFullscreen()) {
                        player.exitFullscreen();
                    }
                }
            });
        }
        window.onkeydown = function(e) {
            let key = e.which || e.keyCode;
            if (document.activeElement.tagName === "INPUT") return;
            if (key === 32) {
                e.preventDefault();
                player.paused() ? player.play() : player.pause();
                overlayMessage(player.paused() ? "Paused" : "Playing");
            } 
            else if ([37, 39].indexOf(key) > -1) {
                e.preventDefault();
                let skip = e.ctrlKey ? 120 : 5;
                let direction = (key === 39) ? 1 : -1;
                player.currentTime(player.currentTime() + (direction * skip));
                displayTime();
            }
            else if ([38, 40].indexOf(key) > -1) {
                e.preventDefault();
                let skip = e.ctrlKey ? 300 : 20;
                let direction = (key === 38) ? 1 : -1;
                player.currentTime(player.currentTime() + (direction * skip));
                displayTime();
            }
            else if (key === 70) {
                if (!player.isFullscreen()) {
                    player.requestFullscreen();
                } else {
                    player.exitFullscreen();
                }
            }
            else if (key === 76) {
                let link = prompt("Enter Video Link:", "");
                if (link) {
                    url = link;
                    loadPlayer();
                }
            }
            else if (key === 83) {
                let newRate = playbackRates[playbackRateIndex++ % playbackRates.length];
                player.playbackRate(newRate);
                overlayMessage("Speed: " + newRate + "x");
            }
            else if (key === 77) {
                player.muted(!player.muted());
                overlayMessage(player.muted() ? "Muted" : "Unmuted");
            }
        };

        async function loadPlayer() {
            if (location.hash.length > 1) {
                url = location.hash.slice(1);
            }

            if (url) {
                overlayMessage("Loading...");
                document.title = url;
                location.hash = "#" + url;
                player.src({
                    src: url,
                });
                player.ready(() => {
                    player.play().catch(e => console.log("Autoplay blocked or error:", e));
                });
            }
        }

        function overlayMessage(msg) {
            let x = document.getElementById("message");
            x.innerHTML = msg;
            x.style.visibility = "visible";
            clearTimeout(overlayMessageTimeout);
            overlayMessageTimeout = setTimeout(() => {
                x.style.visibility = "hidden";
            }, 2000);
        }

        function displayTime() {
            let current = secondsToTime(player.currentTime());
            let total = secondsToTime(player.duration());
            overlayMessage(`${current} / ${total}`);
        }

        function secondsToTime(secs) {
            if (isNaN(secs)) return "00:00:00";
            return new Date(secs * 1000).toISOString().slice(11, 19);
        }
    </script>
</body>
</html>
